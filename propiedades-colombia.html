<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Propiedades en Colombia - FM Inmobiliaria</title>
    <meta name="description" content="Explora nuestro portafolio completo de propiedades en venta y arriendo en Colombia. Encuentra tu próximo hogar con FM Inmobiliaria.">
    
    <link rel="icon" href="https://fminmobiliaria.com.co/wp-content/uploads/2023/05/LOGO-FINAL-FM_Mesa-de-trabajo-1.png" type="image/png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --dark: #1a1a1a;
            --light: #f5f5f5;
            --gold: #C4A66A;
            --border-color: #e5e5e5;
            --font-main: 'Inter', sans-serif;
        }

        /* === Reset & Base === */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: var(--font-main);
            background-color: var(--light);
            color: var(--dark);
            overflow-x: hidden;
        }
        .container { max-width: 1600px; margin: 0 auto; padding: 0 3rem; }

        /* === Navbar (Estilo Oscuro) === */
        .navbar {
            position: fixed; top: 0; left: 0; width: 100%; padding: 1rem 3rem;
            z-index: 1000; display: flex; justify-content: space-between; align-items: center;
            background-color: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border-color);
        }
        .logo img { height: 50px; }
        .menu-button { font-size: 1rem; font-weight: 500; text-decoration: none; color: var(--dark); cursor: pointer; z-index: 1001; }
        .menu-button.menu-open { color: var(--light); }
        
        .fullscreen-menu { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--dark); z-index: 999; display: flex; justify-content: center; align-items: center; visibility: hidden; opacity: 0; }
        .fullscreen-menu-nav { text-align: center; }
        .fullscreen-menu-nav ul { list-style: none; }
        .fullscreen-menu-nav li { margin: 1rem 0; overflow: hidden; }
        .fullscreen-menu-link { font-size: clamp(2.5rem, 6vw, 5rem); color: var(--light); text-decoration: none; font-weight: 700; display: inline-block; transform: translateY(100%); }
        
        .footer { padding: 3rem; display: flex; justify-content: space-between; align-items: center; font-size: 0.9rem; flex-wrap: wrap; border-top: 1px solid var(--border-color); margin-top: 5rem;}
        .social-links { display: flex; gap: 1.5rem; flex-wrap: wrap; }
        .social-links a { color: var(--dark); text-decoration: none; transition: color 0.3s ease; }
        .social-links a:hover { color: var(--gold); }


        /* === Página de Propiedades === */
        .properties-page {
            padding-top: 120px; 
            padding-bottom: 5rem;
        }
        .page-header {
            padding: 4rem 0;
            text-align: left;
            overflow: hidden;
        }
        .page-header h1 {
            font-size: clamp(2.5rem, 6vw, 4.5rem);
            font-weight: 700;
        }
        .page-header .word {
            display: inline-block;
            overflow: hidden;
            margin-right: 0.25em;
        }
        .page-header .char {
            display: inline-block;
            transform: translateY(110%);
        }

        .search-bar-container {
            background-color: #fff;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            margin-bottom: 3rem;
            display: flex;
            gap: 1rem;
            align-items: center;
            border: 1px solid var(--border-color);
        }
        #search-input {
            width: 100%; padding: 0.8rem; border: none;
            font-family: var(--font-main); font-size: 1rem; flex-grow: 1;
        }
        #search-bar-btn {
            background-color: var(--dark); color: var(--light); border: none; padding: 0.8rem 1.5rem;
            border-radius: 8px; cursor: pointer; transition: background-color 0.3s; font-size: 1rem;
        }
        
        .properties-layout {
            display: flex;
            gap: 3rem;
            align-items: flex-start;
        }
        .filters-sidebar {
             background-color: #fff;
             padding: 1.5rem;
             border-radius: 12px;
             border: 1px solid var(--border-color);
             height: fit-content;
             width: 280px;
             flex-shrink: 0;
        }
        .results-container {
            flex-grow: 1;
            min-width: 0;
        }

        .filters-sidebar h3 {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }
        .filter-group { 
            display: flex; 
            flex-direction: column;
            margin-bottom: 1.5rem;
        }
        .filter-group label { margin-bottom: 0.5rem; font-weight: 500; font-size: 0.9rem; }
        .filter-group input, .filter-group select {
            width: 100%; padding: 0.8rem; border-radius: 8px; border: 1px solid var(--border-color);
            font-family: var(--font-main); font-size: 1rem;
        }
        .tag-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .filter-tag-btn {
            background-color: var(--light);
            border: 1px solid var(--border-color);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        .filter-tag-btn.active {
            background-color: var(--dark);
            color: var(--light);
            border-color: var(--dark);
        }
        #apply-filters-btn {
            width: 100%;
            background-color: var(--dark); color: var(--light); border: none; padding: 0.8rem 1.5rem;
            border-radius: 8px; cursor: pointer; transition: background-color 0.3s; font-size: 1rem;
            margin-top: 1rem;
        }
        #clear-filters-btn {
            width: 100%;
            background-color: transparent; color: var(--dark); border: 1px solid var(--border-color);
            padding: 0.8rem 1.5rem; border-radius: 8px; cursor: pointer; transition: all 0.3s;
            font-size: 1rem; margin-top: 0.5rem;
        }
        #clear-filters-btn:hover {
            background-color: var(--light); border-color: var(--dark);
        }

        /* === Estilos de Tarjetas === */
        .property-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 2rem; 
        }
        .property-card { background-color: #fff; border: 1px solid var(--border-color); border-radius: 16px; padding: 1rem; transition: all 0.3s ease; }
        .property-card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0,0,0, 0.08); }
        .property-image-container { border-radius: 12px; overflow: hidden; height: 250px; margin-bottom: 1.5rem; }
        .property-image-container img { width: 100%; height: 100%; object-fit: cover; }
        .property-info-top, .property-info-bottom { display: flex; justify-content: space-between; align-items: center; }
        .property-info-top h4 { font-size: 1.25rem; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-right: 1rem; }
        .property-type-tag { background-color: var(--gold); color: var(--dark); padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem; font-weight: 500; white-space: nowrap; }
        .property-location { color: #666; margin: 0.5rem 0 1rem 0; }
        .property-details { display: flex; gap: 1.5rem; padding: 1rem 0; border-top: 1px solid var(--border-color); border-bottom: 1px solid var(--border-color); margin-bottom: 1rem; }
        .property-details-item { display: flex; align-items: center; gap: 0.5rem; color: #444; }
        .property-price { font-size: 1.5rem; font-weight: 700; color: var(--dark); }
        .view-details-btn { background-color: var(--dark); color: var(--light); border: none; padding: 0.8rem 1.5rem; border-radius: 8px; cursor: pointer; transition: background-color 0.3s; text-decoration: none; }
        .loading-wasi { text-align: center; font-size: 1.2rem; color: #888; padding: 2rem; grid-column: 1 / -1; }
        
        /* === Paginación === */
        .pagination-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin-top: 4rem;
        }
        .pagination-btn {
            background-color: #fff;
            border: 1px solid var(--border-color);
            color: var(--dark);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .pagination-btn:hover {
            background-color: var(--dark);
            color: var(--light);
        }
        .pagination-btn.active {
            background-color: var(--dark);
            color: var(--light);
        }
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        @media (max-width: 992px) {
            .properties-layout { flex-direction: column; }
            .filters-sidebar { width: 100%; margin-bottom: 2rem; }
        }
        @media (max-width: 768px) {
            .navbar { padding: 1.5rem; }
            .container { padding: 0 1.5rem; }
            .footer { flex-direction: column; gap: 1rem; text-align: center; }
            .property-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <nav class="navbar">
        <a href="index.html" class="logo">
            <img src="https://fminmobiliaria.com.co/wp-content/uploads/2023/05/LOGO-FINAL-FM_Mesa-de-trabajo-1.png" alt="Logo FM Inmobiliaria">
        </a>
        <a href="#" class="menu-button">Menú</a>
    </nav>

    <div class="fullscreen-menu">
        <nav class="fullscreen-menu-nav">
            <ul>
                <li><a href="index.html#services" class="fullscreen-menu-link">Servicios</a></li>
                <li><a href="index.html#markets" class="fullscreen-menu-link">Mercados</a></li>
                <li><a href="index.html#gallery" class="fullscreen-menu-link">Proyectos</a></li>
                <li><a href="index.html#contact" class="fullscreen-menu-link">Contacto</a></li>
            </ul>
        </nav>
    </div>

    <main class="properties-page">
        <div class="container">
            <div class="page-header">
                <h1>
                    <span class="word"><span class="char">P</span><span class="char">r</span><span class="char">o</span><span class="char">p</span><span class="char">i</span><span class="char">e</span><span class="char">d</span><span class="char">a</span><span class="char">d</span><span class="char">e</span><span class="char">s</span></span>
                    <span class="word"><span class="char">e</span><span class="char">n</span></span>
                    <span class="word"><span class="char">C</span><span class="char">o</span><span class="char">l</span><span class="char">o</span><span class="char">m</span><span class="char">b</span><span class="char">i</span><span class="char">a</span></span>
                </h1>
            </div>

            <div class="search-bar-container">
                 <input type="text" id="search-input" placeholder="Buscar por palabra clave. Ej: Apartamento en Cedritos">
                 <button id="search-bar-btn" class="cta-button">Buscar</button>
            </div>

            <div class="properties-layout">
                <aside class="filters-sidebar">
                    <h3>Filtrar Por</h3>
                    <div class="filter-group">
                        <label>Tipo de Operación</label>
                        <div>
                            <input type="radio" id="op-all" name="operation_type" value="" checked> <label for="op-all">Todas</label>
                        </div>
                        <div>
                            <input type="radio" id="op-sale" name="operation_type" value="true"> <label for="op-sale">Venta</label>
                        </div>
                        <div>
                            <input type="radio" id="op-rent" name="operation_type" value="false"> <label for="op-rent">Arriendo</label>
                        </div>
                    </div>
                    <div class="filter-group">
                        <label>Tipo de Inmueble</label>
                        <div id="type-filter-group" class="tag-group">
                            </div>
                    </div>
                    <div class="filter-group">
                        <label>Ciudades</label>
                        <div id="city-filter-group" class="tag-group">
                            </div>
                    </div>
                    <div class="filter-group">
                        <label for="bedrooms-select">Habitaciones</label>
                        <select id="bedrooms-select">
                            <option value="">Cualquiera</option>
                            <option value="1">1+</option>
                            <option value="2">2+</option>
                            <option value="3">3+</option>
                            <option value="4">4+</option>
                        </select>
                    </div>
                     <button id="apply-filters-btn">Aplicar Filtros</button>
                     <button id="clear-filters-btn" class="clear-button">Limpiar Filtros</button>
                </aside>
                
                <div class="results-container">
                    <div class="property-grid">
                        <div class="loading-wasi">Cargando propiedades...</div>
                    </div>
                    <div class="pagination-container"></div>
                </div>
            </div>

        </div>
    </main>

    <footer class="footer">
        <div class="copyright">
            &copy; <span id="year"></span> FM Inmobiliaria. Todos los derechos reservados.
        </div>
        <div class="social-links">
             <a href="https://www.instagram.com/fm_inmobiliaria/" target="_blank">Instagram</a>
             <a href="https://www.youtube.com/channel/UCEUtg5vtxIvggYBiJ_vLt3Q" target="_blank">YouTube</a>
             <a href="https://www.facebook.com/profile.php?id=100084233577175" target="_blank">Facebook</a>
             <a href="https://www.linkedin.com/in/fabian-andres-moreno-oliveros-71871121/" target="_blank">LinkedIn</a>
             <a href="https://twitter.com/famoli09" target="_blank">Twitter</a>
             <a href="https://www.tiktok.com/@user4965767830058?lang=es" target="_blank">TikTok</a>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
    <script src="https://code.iconify.design/3/3.1.0/iconify.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        let allProperties = [];
        let filteredProperties = [];
        let currentPage = 1;
        const propertiesPerPage = 9;
        
        const gridContainer = document.querySelector('.property-grid');
        const loading = document.querySelector('.loading-wasi');
        const searchInput = document.getElementById('search-input');
        const cityFilterGroup = document.getElementById('city-filter-group');
        const typeFilterGroup = document.getElementById('type-filter-group');
        const bedroomsSelect = document.getElementById('bedrooms-select');
        const applyFiltersBtn = document.getElementById('apply-filters-btn');
        const searchBarBtn = document.getElementById('search-bar-btn');
        const clearFiltersBtn = document.getElementById('clear-filters-btn');
        const paginationContainer = document.querySelector('.pagination-container');

        function renderProperties() {
            gridContainer.innerHTML = '';
            const startIndex = (currentPage - 1) * propertiesPerPage;
            const endIndex = startIndex + propertiesPerPage;
            const paginatedProperties = filteredProperties.slice(startIndex, endIndex);

            if (paginatedProperties.length === 0) {
                gridContainer.innerHTML = `<div class="loading-wasi">No se encontraron propiedades con estos criterios.</div>`;
                return;
            }
            
            let html = '';
            paginatedProperties.forEach(prop => {
                if (!prop || !prop.id_property || !prop.title) return;
                const price = prop.for_sale === 'true' ? prop.sale_price_label : prop.rent_price_label;
                const location = `${prop.city_label || ''}, ${prop.country_label || ''}`.replace(/^, |, $/g, '').trim();
                const image = prop.main_image ? prop.main_image.url : 'https://placehold.co/600x400/f5f5f5/1a1a1a?text=Propiedad';
                const type = prop.for_sale === 'true' ? 'Venta' : 'Arriendo';
                const bedrooms = prop.bedrooms || 0;
                const bathrooms = prop.bathrooms || 0;
                const area = prop.built_area || '--';

                html += `
                    <div class="property-card">
                        <div class="property-image-container"><img src="${image}" alt="${prop.title}"></div>
                        <div class="property-info-top"><h4>${prop.title}</h4><span class="property-type-tag">${type}</span></div>
                        <p class="property-location">${location}</p>
                        <div class="property-details">
                            <div class="property-details-item"><span class="iconify" data-icon="ph:bed-bold"></span><span>${bedrooms} hab.</span></div>
                            <div class="property-details-item"><span class="iconify" data-icon="ph:bathtub-bold"></span><span>${bathrooms} baños</span></div>
                            <div class="property-details-item"><span class="iconify" data-icon="ph:ruler-bold"></span><span>${area} m²</span></div>
                        </div>
                        <div class="property-info-bottom">
                            <p class="property-price">${price}</p>
                            <a href="propiedad.html?id=${prop.id_property}" class="view-details-btn">Ver Detalles</a>
                        </div>
                    </div>`;
            });
            gridContainer.innerHTML = html;
        }
        
        function setupPagination() {
            paginationContainer.innerHTML = '';
            const pageCount = Math.ceil(filteredProperties.length / propertiesPerPage);

            if (pageCount <= 1) return;

            const prevButton = document.createElement('button');
            prevButton.textContent = 'Anterior';
            prevButton.classList.add('pagination-btn');
            prevButton.disabled = currentPage === 1;
            prevButton.addEventListener('click', () => {
                if(currentPage > 1) {
                    currentPage--;
                    renderProperties();
                    setupPagination();
                    window.scrollTo({ top: document.querySelector('.properties-layout').offsetTop, behavior: 'smooth' });
                }
            });
            paginationContainer.appendChild(prevButton);

            for (let i = 1; i <= pageCount; i++) {
                const pageButton = document.createElement('button');
                pageButton.textContent = i;
                pageButton.classList.add('pagination-btn');
                if (i === currentPage) { pageButton.classList.add('active'); }
                pageButton.addEventListener('click', () => {
                    currentPage = i;
                    renderProperties();
                    setupPagination();
                    window.scrollTo({ top: document.querySelector('.properties-layout').offsetTop, behavior: 'smooth' });
                });
                paginationContainer.appendChild(pageButton);
            }

            const nextButton = document.createElement('button');
            nextButton.textContent = 'Siguiente';
            nextButton.classList.add('pagination-btn');
            nextButton.disabled = currentPage === pageCount;
            nextButton.addEventListener('click', () => {
                if (currentPage < pageCount) {
                    currentPage++;
                    renderProperties();
                    setupPagination();
                    window.scrollTo({ top: document.querySelector('.properties-layout').offsetTop, behavior: 'smooth' });
                }
            });
            paginationContainer.appendChild(nextButton);
        }

        function populateFilters(data) {
            const { cities, propertyTypes } = data;
            
            cities.sort().forEach(city => {
                cityFilterGroup.innerHTML += `<button class="filter-tag-btn" data-value="${city}">${city}</button>`;
            });

            propertyTypes.sort((a, b) => a.name.localeCompare(b.name)).forEach(type => {
                if(type.name && type.name !== 'No especificado') typeFilterGroup.innerHTML += `<button class="filter-tag-btn" data-value="${type.name}">${type.name}</button>`;
            });
            
            document.querySelectorAll('.filter-tag-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    btn.classList.toggle('active');
                });
            });
        }

        function applyFilters() {
            const searchTerm = searchInput.value.toLowerCase();
            const selectedOperation = document.querySelector('input[name="operation_type"]:checked').value;
            const selectedCities = [...cityFilterGroup.querySelectorAll('.filter-tag-btn.active')].map(btn => btn.dataset.value);
            const selectedTypes = [...typeFilterGroup.querySelectorAll('.filter-tag-btn.active')].map(btn => btn.dataset.value);
            const minBedrooms = parseInt(bedroomsSelect.value) || 0;
            
            filteredProperties = allProperties.filter(prop => {
                const titleMatch = prop.title ? prop.title.toLowerCase().includes(searchTerm) : true;
                const operationMatch = !selectedOperation || String(prop.for_sale) === selectedOperation;
                const cityMatch = selectedCities.length === 0 || selectedCities.includes(prop.city_label);
                const typeMatch = selectedTypes.length === 0 || selectedTypes.includes(prop.property_type.name);
                const bedroomsMatch = !minBedrooms || (parseInt(prop.bedrooms) >= minBedrooms);
               
                return titleMatch && operationMatch && cityMatch && typeMatch && bedroomsMatch;
            });
            currentPage = 1;
            renderProperties();
            setupPagination();
        }

        function clearFilters() {
            searchInput.value = '';
            document.querySelector('input[name="operation_type"][value=""]').checked = true;
            document.querySelectorAll('.filter-tag-btn.active').forEach(btn => btn.classList.remove('active'));
            bedroomsSelect.value = '';
            applyFilters();
        }
        
        async function fetchAllData() {
            try {
                const response = await fetch('/api/getAllProperties');
                if (!response.ok) throw new Error('Error de red');
                
                const data = await response.json();
                allProperties = data.properties;
                filteredProperties = [...allProperties];
                
                renderProperties();
                setupPagination();
                populateFilters(data);

                if(loading) loading.style.display = 'none';

            } catch (error) {
                console.error("Error al cargar propiedades:", error);
                if(loading) loading.textContent = 'No se pudieron cargar las propiedades.';
            }
        }
        
        fetchAllData();
        
        applyFiltersBtn.addEventListener('click', applyFilters);
        searchBarBtn.addEventListener('click', applyFilters);
        clearFiltersBtn.addEventListener('click', clearFilters);
        searchInput.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') applyFilters();
        });

        const menuButton = document.querySelector('.menu-button');
        const fullscreenMenu = document.querySelector('.fullscreen-menu');
        const menuLinks = document.querySelectorAll('.fullscreen-menu-link');
        const menuTl = gsap.timeline({ paused: true });
        menuTl.to(fullscreenMenu, { visibility: 'visible', duration: 0.01 }).to(fullscreenMenu, { opacity: 1, duration: 0.5, ease: 'power2.inOut' }).to(menuLinks, { y: 0, stagger: 0.1, duration: 0.8, ease: 'power3.out' }, "-=0.3");
        menuButton.addEventListener('click', (e) => { e.preventDefault(); if (menuButton.classList.contains('menu-open')) { menuButton.textContent = 'Menú'; menuTl.reverse(); document.body.style.overflow = ''; } else { menuButton.textContent = 'Cerrar'; menuTl.play(); document.body.style.overflow = 'hidden'; } menuButton.classList.toggle('menu-open'); });
        menuLinks.forEach(link => { link.addEventListener('click', () => { menuButton.textContent = 'Menú'; menuTl.reverse(); document.body.style.overflow = ''; menuButton.classList.remove('menu-open'); }); });
        
        document.getElementById('year').textContent = new Date().getFullYear();
        
        const titleWords = gsap.utils.toArray('.page-header .word');
        titleWords.forEach(word => {
            const chars = word.querySelectorAll('.char');
            gsap.to(chars, {
                y: 0,
                stagger: 0.05,
                duration: 1,
                ease: 'power3.out',
                delay: 0.5
            });
        });
    });
    </script>
</body>
</html>